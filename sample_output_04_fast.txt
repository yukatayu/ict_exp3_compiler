ORG 0 / Interrupt Entry Point
INT_RET, HEX 0 / Interrupt Return Address
BUN INT_MAIN
ORG 10 / Entry Point
LDA MASKINIT
IMK
SIO
ION

 / > while loop MainLoop
XWH1MainLoop,
 / while (
    LDA HaltFlag
SZA
BUN XWH3MainLoop
BUN XWH2MainLoop
 / ) {
XWH2MainLoop,
BUN XWH1MainLoop
 / }
XWH3MainLoop,
 / < end of while loop MainLoop

_M_, HLT

 / > beginning of INT_MAIN
INT_MAIN,
    STA ACCBAK
    CLA
    CIL
    STA EBAK
    CLA
    STA OutFlag

     / > if InputAvailable
     / if (
        CLA
        INC
    SZA
    BUN XIF1InputAvailable
    BUN XIF2InputAvailable
     / ) {
    XIF1InputAvailable,
        SKI
        BUN InterruptReturn
        INP
        STA INTmp

             / > if CheckCharEnt
             / if (
                LDA ASCIIENTER
                CMA
                INC
                ADD INTmp
            SZA
            BUN XIF2CheckCharEnt
            BUN XIF1CheckCharEnt
             / ) {
            XIF1CheckCharEnt,
                CLA
                INC
                STA OutFlag

                 / > while loop PrimeSearchLoop
                XWH1PrimeSearchLoop,
                 / while (
                    LDA N
                SZA
                BUN XWH2PrimeSearchLoop
                BUN XWH3PrimeSearchLoop
                 / ) {
                XWH2PrimeSearchLoop,

                     / > beginning of CP
                    CP,
                        LDA IINIT
                        STA I
                        LDA IINIT
                        CMA
                        INC
                        STA MI
                        LDA I2INIT
                        STA I2
                        CLA
                        STA CPRET

                         / > while loop CPLoop
                        XWH1CPLoop,
                         / while (
                            LDA I2
                            CLE
                            CME
                            SZA
                            CME
                            CLA
                            CIL
                            STA TEMP1
                            LDA I2
                            CMA
                            INC
                            ADD N
                            CLA
                            CIL
                            ADD TEMP1
                        SZA
                        BUN XWH2CPLoop
                        BUN XWH3CPLoop
                         / ) {
                        XWH2CPLoop,
                            LDA I
                            STA ISH
                            LDA N
                            STA ITMP

                             / > if CPSkip1
                             / if (
                                LDA I
                                CLE
                                CIR
                                CLE
                                CIR
                            SZA
                            BUN XIF1CPSkip1
                            BUN XIF2CPSkip1
                             / ) {
                            XIF1CPSkip1,
                                LDA I
                                CIR
                                CME
                                SZE
                                BUN CPCont
                             / }
                            XIF2CPSkip1,
                             / < end of if CPSkip1


                             / > while loop CPPre
                            XWH1CPPre,
                             / while (
                                LDA ISH
                                CIL
                                CLA
                                CIL
                            SZA
                            BUN XWH3CPPre
                            BUN XWH2CPPre
                             / ) {
                            XWH2CPPre,
                                LDA ISH
                                CLE
                                CIL
                                STA ISH
                            BUN XWH1CPPre
                             / }
                            XWH3CPPre,
                             / < end of while loop CPPre


                             / > while loop CPMain
                            XWH1CPMain,
                             / while (
                                LDA I
                                CLE
                                CME
                                SZA
                                CME
                                CLA
                                CIL
                                STA TEMP1
                                LDA I
                                CMA
                                INC
                                ADD ISH
                                CLA
                                CIL
                                ADD TEMP1
                            SZA
                            BUN XWH2CPMain
                            BUN XWH3CPMain
                             / ) {
                            XWH2CPMain,

                                 / > if DivCmp
                                 / if (
                                    LDA ISH
                                    CLE
                                    CME
                                    SZA
                                    CME
                                    CLA
                                    CIL
                                    STA TEMP1
                                    LDA ISH
                                    CMA
                                    INC
                                    ADD ITMP
                                    CLA
                                    CIL
                                    ADD TEMP1
                                SZA
                                BUN XIF1DivCmp
                                BUN XIF2DivCmp
                                 / ) {
                                XIF1DivCmp,
                                    LDA ISH
                                    CMA
                                    INC
                                    ADD ITMP
                                    STA ITMP
                                 / }
                                XIF2DivCmp,
                                 / < end of if DivCmp

                                LDA ISH
                                CLE
                                CIR
                                STA ISH
                            BUN XWH1CPMain
                             / }
                            XWH3CPMain,
                             / < end of while loop CPMain


                             / > if CPBreak
                             / if (
                                LDA ITMP
                            SZA
                            BUN XIF2CPBreak
                            BUN XIF1CPBreak
                             / ) {
                            XIF1CPBreak,
                                BUN CPEnd
                             / }
                            XIF2CPBreak,
                             / < end of if CPBreak

                            CPCont,
                            LDA I
                            CLE
                            CIL
                            ADD I2
                            STA I2
                            LDA I2
                            INC
                            STA I2
                            LDA I
                            INC
                            STA I
                            LDA MI
                            CMA
                            INC
                            CMA
                            STA MI
                        BUN XWH1CPLoop
                         / }
                        XWH3CPLoop,
                         / < end of while loop CPLoop

                        CLA
                        INC
                        STA CPRET
                        CPEnd,
                     / < end of CP


                     / > if BreakCPRet
                     / if (
                        LDA CPRET
                    SZA
                    BUN XIF1BreakCPRet
                    BUN XIF2BreakCPRet
                     / ) {
                    XIF1BreakCPRet,
                        BUN XWH3PrimeSearchLoop
                     / }
                    XIF2BreakCPRet,
                     / < end of if BreakCPRet

                    LDA N
                    CMA
                    INC
                    CMA
                    STA N
                BUN XWH1PrimeSearchLoop
                 / }
                XWH3PrimeSearchLoop,
                 / < end of while loop PrimeSearchLoop

             / }
            XIF2CheckCharEnt,
             / < end of if CheckCharEnt

            LDA ASCII0
            CMA
            INC
            ADD INTmp
            STA TEMP1

             / > if CheckCharCtrlD
             / if (
                LDA ASCIICTRLD
                CMA
                INC
                ADD INTmp
            SZA
            BUN XIF2CheckCharCtrlD
            BUN XIF1CheckCharCtrlD
             / ) {
            XIF1CheckCharCtrlD,
                CLA
                INC
                STA HaltFlag
             / }
            XIF2CheckCharCtrlD,
             / < end of if CheckCharCtrlD


             / > if CheckCharNum
             / if (
                LDA TEMP1
                CLE
                CME
                SZA
                CME
                CLA
                CIL
                STA TEMP2
                LDA TEMP1
                CMA
                INC
                ADD DECVAL
                CLA
                CIL
                ADD TEMP2
            SZA
            BUN XIF1CheckCharNum
            BUN XIF2CheckCharNum
             / ) {
            XIF1CheckCharNum,

                 / > if CheckCharNumPosi
                 / if (
                    LDA TEMP1
                    CIL
                    CLA
                    CIL
                SZA
                BUN XIF2CheckCharNumPosi
                BUN XIF1CheckCharNumPosi
                 / ) {
                XIF1CheckCharNumPosi,
                    LDA N
                    CLE
                    CIL
                    STA N
                    LDA N
                    CLE
                    CIL
                    CLE
                    CIL
                    ADD N
                    ADD TEMP1
                    STA N
                 / }
                XIF2CheckCharNumPosi,
                 / < end of if CheckCharNumPosi

             / }
            XIF2CheckCharNum,
             / < end of if CheckCharNum

     / }
    XIF2InputAvailable,
     / < end of if InputAvailable


     / > if OutputAvailable
     / if (
        CLA
        INC
    SZA
    BUN XIF1OutputAvailable
    BUN XIF2OutputAvailable
     / ) {
    XIF1OutputAvailable,
        SKO
        BUN InterruptReturn

         / > while loop ShowMain
        XWH1ShowMain,
         / while (

             / > beginning of GetDigitOne
            GetDigitOne,

                 / > if GetDigitOutT
                 / if (
                    LDA OutFlag
                SZA
                BUN XIF1GetDigitOutT
                BUN XIF2GetDigitOutT
                 / ) {
                XIF1GetDigitOutT,
                    CLA
                    STA OutFlag
                    CLA
                    STA ShowIParam
                    LDA N
                    STA QVAL

                     / > while loop ShowSubDigit
                    XWH1ShowSubDigit,
                     / while (
                        LDA QVAL
                    SZA
                    BUN XWH2ShowSubDigit
                    BUN XWH3ShowSubDigit
                     / ) {
                    XWH2ShowSubDigit,
                        LDA QVAL
                        STA RVAL
                        LDA DECVAL
                        CMA
                        INC
                        ADD QVAL
                        STA XVAL
                        CLA
                        STA QVAL

                         / > while loop ShowSubSearch
                        XWH1ShowSubSearch,
                         / while (
                            LDA RVAL
                            CLE
                            CME
                            SZA
                            CME
                            CLA
                            CIL
                            STA TEMP1
                            LDA RVAL
                            CMA
                            INC
                            ADD XVAL
                            CLA
                            CIL
                            ADD TEMP1
                        SZA
                        BUN XWH3ShowSubSearch
                        BUN XWH2ShowSubSearch
                         / ) {
                        XWH2ShowSubSearch,
                            LDA XVAL
                            STA RVAL
                            LDA DECVAL
                            CMA
                            INC
                            ADD XVAL
                            STA XVAL
                            LDA QVAL
                            INC
                            STA QVAL
                        BUN XWH1ShowSubSearch
                         / }
                        XWH3ShowSubSearch,
                         / < end of while loop ShowSubSearch

                        LDA ShowIParam
                        INC
                        STA ShowIParam
                    BUN XWH1ShowSubDigit
                     / }
                    XWH3ShowSubDigit,
                     / < end of while loop ShowSubDigit

                 / }
                XIF2GetDigitOutT,
                 / < end of if GetDigitOutT

                CLA
                INC
                STA ISH
                LDA ShowIParam
                STA I
                LDA N
                STA QVAL

                 / > if NothingToShow
                 / if (
                    LDA I
                SZA
                BUN XIF2NothingToShow
                BUN XIF1NothingToShow
                 / ) {
                XIF1NothingToShow,
                    CLA
                    BUN GetDigitOutT_End
                 / }
                XIF2NothingToShow,
                 / < end of if NothingToShow


                 / > while loop DispIShift
                XWH1DispIShift,
                 / while (
                    LDA I
                    CMA
                    INC
                    CMA
                    STA I
                SZA
                BUN XWH2DispIShift
                BUN XWH3DispIShift
                 / ) {
                XWH2DispIShift,
                    LDA ISH
                    CLE
                    CIL
                    STA ISH
                    LDA ISH
                    CLE
                    CIL
                    CLE
                    CIL
                    ADD ISH
                    STA ISH
                BUN XWH1DispIShift
                 / }
                XWH3DispIShift,
                 / < end of while loop DispIShift

                LDA ISH
                CMA
                INC
                ADD N
                STA XVAL
                CLA
                STA QVAL
                LDA N
                STA RVAL

                 / > while loop ShowSub
                XWH1ShowSub,
                 / while (
                    LDA RVAL
                    CLE
                    CME
                    SZA
                    CME
                    CLA
                    CIL
                    STA TEMP1
                    LDA RVAL
                    CMA
                    INC
                    ADD XVAL
                    CLA
                    CIL
                    ADD TEMP1
                SZA
                BUN XWH3ShowSub
                BUN XWH2ShowSub
                 / ) {
                XWH2ShowSub,
                    LDA XVAL
                    STA RVAL
                    LDA ISH
                    CMA
                    INC
                    ADD XVAL
                    STA XVAL
                    LDA QVAL
                    INC
                    STA QVAL
                BUN XWH1ShowSub
                 / }
                XWH3ShowSub,
                 / < end of while loop ShowSub

                LDA RVAL
                STA N
                LDA QVAL
                STA TEMP2
                LDA ShowIParam
                CMA
                INC
                CMA
                STA ShowIParam
                LDA TEMP2
                ADD ASCII0
                GetDigitOutT_End,
             / < end of GetDigitOne

        SZA
        BUN XWH2ShowMain
        BUN XWH3ShowMain
         / ) {
        XWH2ShowMain,
            OUT
        BUN XWH1ShowMain
         / }
        XWH3ShowMain,
         / < end of while loop ShowMain

     / }
    XIF2OutputAvailable,
     / < end of if OutputAvailable

    InterruptReturn,

     / > if HaltTrigger
     / if (
        LDA HaltFlag
    SZA
    BUN XIF1HaltTrigger
    BUN XIF2HaltTrigger
     / ) {
    XIF1HaltTrigger,
        LDA EBAK
        CLE
        CIR
        LDA ACCBAK
        BUN INT_RET I
     / }
    XIF2HaltTrigger,
     / < end of if HaltTrigger

    LDA EBAK
    CLE
    CIR
    LDA ACCBAK
    ION
    BUN INT_RET I
 / < end of INT_MAIN

 / Data Segment
    ACCBAK, DEC 0
    EBAK, DEC 0
    MASKINIT, DEC 15
    ShowIParam, DEC 0
    OutFlag, DEC 0
    HaltFlag, DEC 0
    INTmp, DEC 0
    N, DEC 0
    ASCII0, DEC 48
    ASCIIENTER, DEC 10
    ASCIICTRLD, DEC 4
    DECVAL, DEC 10
    CPRET, DEC 0
    IINIT, DEC 2
    I2INIT, DEC 4
    I, DEC 0
    ITMP, DEC 0
    MI, DEC 0
    I2, DEC 0
    ISH, DEC 0
    TEMP1, DEC 0
    TEMP2, DEC 0
    QVAL, DEC 0
    RVAL, DEC 0
    XVAL, DEC 0
END

